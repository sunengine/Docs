## Установка на сервер
Все ".sh" скрипты находятся в директории "Scripts/".

### Для публикации на сервере необходимо выполнить следующие действия:

    Запустить скрипт "build.sh".
    Подготовить параметры скрипта "publish.sh" переименовав "PUBLISH.template" в "PUBLISH" отредактировать настройки внутри.
    Запустить скрипт "publish.sh".

### Создание сборки

#### Скрипт: build.sh
Скрипт работает из коробки. 
После запуска весь проект собирается в директорию  "build". 
Клиентская часть кладётся в  "build/wwwroot".
Для настройки по умолчанию используется файл "BUILD", либо укажите файл с настройками первым аргументом.
"build.sh /path/to/BUILD_VARS"

### Настройки скрипта: BUILD

PROJECT_NAME="SunEngine" - Имя проекта, используется для вывода в консоли
PROJECT_ROOT="auto"      - Путь к корневой папке проекта.
                           Значение "auto": текущая папка или папка выше определяется содержанием в папке файла .SunEngineRoot.  
SERVER_PATH="${PROJECT_ROOT}/Server" - Путь к серверной части проекта (DotNet solution)
CLIENT_PATH="${PROJECT_ROOT}/Client" - Путь к клиентской части проекта (Quasar project)
CONFIG_PATH="${PROJECT_ROOT}/Config" - Путь к папке с конфигурацией проекта
BUILD_PATH="${PROJECT_ROOT}/build"   - Путь куда будет помещена результирующая сборка проекта
NPM_UTIL="yarn"                      - Установщик npm пакетов (yarn или npm)

### Установка на сервер

#### Скрипт: publish.sh

Перед запуском необходимо отредактировать параметры в "PUBLISH" файле настроек скрипта.

Скрипт "publish.sh" записывает директорию "build" на сервер, перезаписывая все файлы, а директорию "Config" записывает только если её ещё нет на сервере.

Для настройки по умолчанию используется файл "PUBLISH", либо укажите файл с настройками первым аргументом.

"publish.sh /path/to/PUBLISH_VARS"

Для того что бы скрипт смог полностью отработать пользователю "username" на сервере (под которым работает скрипт)  надо добавить в группы "www-data", "systemd-journal", "systemd-network", "systemd-network", "systemd-resolve". Это можно сделать отредактировав файл "/etc/group".

### Настройки скрипта: PUBLISH

PROJECT_NAME="SunEngine Demo"           - Имя проекта, используется для вывода в консоли
LOCAL_BUILD_PATH="/path/to/local/build" - Путь к папке build проекта, должен соответствовать BUILD_PATH из файла BUILD
REMOTE_USER="username"                  - Имя пользователя под которым будет производиться коннект к серверу
REMOTE_HOST="111.111.111.111"           - IP или домен хоста сервера
REMOTE_DIRECTORY="/remote/dir/path"     - Путь папки на сервере куда будет осуществляться загрузка
REMOTE_DIRECTORY_OWNER="www-data"       - Пользователь на сервере которому принадлежит папка REMOTE_DIRECTORY
REMOTE_DIRECTORY_GROUP="www-data"       - Группа на сервере которой принадлежит папка REMOTE_DIRECTORY
REMOTE_SYSTEMD_SERVICE_NAME="demo.sunengine.site"  - Имя сервиса systemd для перезапуска после загрузки

### Запись файлов конфигурации

После построение "build.sh" и публикации "publish.sh", необходимо настроить конфигурацию на сервере отредактировать файлы в директории "Config" на сервере, это делается один раз.
Необходимо прописать правильные настройки базы данных в "DataBaseConnection.json"
Остальные настройки - по необходимости.
Директория "Config/Init" служит для стартовой инициализации базы данных сайта - команда "dotnet SunEngine.dll init migrate".
Обновление SunEngine на сервере до последней версии с репозитория GitHub.
Скрипт: update.sh
Скрипт работает из коробки при условии настроенного publish.sh скрипта.
Скрипт берёт последнюю версию из мастер ветки репозитория
"git pull origin master"
И последовательно запускает.
"build.sh" и
"publish.sh" скрипты.


### Настройки скрипта: UPDATE

PROJECT_NAME="SunEngine Demo"   - Имя проекта, используется для вывода в консоли
PROJECT_ROOT="auto"             - Путь к корневой папке проекта.
                                  Значение "auto": текущая папка или папка выше определяется содержанием в папке файла .SunEngineRoot.  
BUILD_SCRIPT_PATH="./build.sh"      - Путь к скрипту сборки
PUBLISH_SCRIPT_PATH="./publish.sh"  - Путь к скрипту публикации


### Метки:


publish

server

публикация

сервер